<script>
  var ue = {}

  function UE_INIT (UE_EL, option) {
    // 实例化ue实例
    var config = Object.assign({}, {
      serverUrl: "{:U('Public/uEditor')}",
      elementPathEnabled: false, // 禁止元素路径显示
      wordCount: false, // 禁止字数统计
      zIndex: 99
    }, option || {})

    ue = UE.getEditor(UE_EL, config);
    // 初始化
    ue.ready(function () {
      // 设置参数
      ue.execCommand('serverparam', {
        'type': 3,
        'from': 'ueditor',
        'domain': window.location.protocol + '//' + window.location.host
      });
    });
  }
  // 获取百度富文本编辑器的html内容[将获取视频第一帧作为封面图poster]
  function getUEContent() {
    return new Promise(function (resolve, reject) {
      var html = ue.getContent();
      document.getElementById('ue-content-html').innerHTML = html;
      if (html !== '') {
        var videoList = document.getElementById('ue-content-html').getElementsByTagName('video');
        var float = 0;
        for (var i = 0; i < videoList.length; i++) {
          var videoDom = videoList[i];
          var videoSrc = videoDom.getAttribute('src');
          var videoUrlOrigin = videoSrc.split('/');
          if (['dl.duinin.com'].indexOf(videoUrlOrigin[2]) > -1) {
            videoDom.setAttribute('src', videoSrc + '?v=1'); // 用于处理跨域缓存
            commonObj.getVideoPoster(videoDom).then(function (posterUrl){
              if (float === videoList.length - 1) {
                videoDom.setAttribute('preload', 'none');
                // videoDom.setAttribute('src', videoSrc);
                resolve(document.getElementById('ue-content-html').innerHTML);
              } else {
                float++;
              }
            })
          } else {
            if (float === videoList.length - 1) {
              resolve(document.getElementById('ue-content-html').innerHTML);
            } else {
              float++;
            }
          }
        }
      }
      resolve(document.getElementById('ue-content-html').innerHTML);
    })

  }
</script>
